{"version":3,"sources":["stopGraph/stopGraph.js","topoSort/topoSort.js","topoSort/index.js","stopGraph/sortedStopList.js","components/StopGraph/StopGraph.js","components/StopGraph/index.js"],"names":["buildStopGraph","theRtif","geographies","get","revenueTrips","Array","from","values","filter","trip","allEdges","_","uniqWith","flatMap","tripLocations","map","event","reverse","froms","tos","slice","zip","to","isEqual","allNodes","uniq","flatten","concat","node","data","id","label","source","target","topoSort","nodes","this","edges","edge","toposort","array","register","cytoscape","impl","Cytoscape","use","buildSortedStopList","elements","headless","CytoscapeDagre","cytoscapeStyles","selector","style","width","height","shape","color","StopGraph","rtif","cyInput","grow","direction","paddingSize","restrictWidth","gutterSize","layout","name","nodeDimensionsIncludeLabels","autoungrabify","autounselectify","minZoom","maxZoom","stylesheet"],"mappings":"uNAuCeA,MApCf,SAAwBC,GACtB,IAAMC,EAAcD,EAAQE,IAAI,aAC1BC,EAAeC,MAAMC,KAAKL,EAAQE,IAAI,QAAQI,UAAUC,QAC5D,SAACC,GAAD,OAAmC,IAAzBA,EAAKN,IAAI,eAGfO,EAAWC,IAAEC,SACjBR,EAAaS,SAAQ,SAACJ,GACpB,IAEMK,EAFSL,EAAKN,IAAI,SAEKY,KAAI,SAACC,GAAD,OAAWA,EAAMb,IAAI,eAExB,MAA1BM,EAAKN,IAAI,cACXQ,IAAEM,QAAQH,GAGZ,IAAMI,EAAQJ,EACRK,EAAMR,IAAES,MAAMN,EAAe,GAEnC,OAAOH,IAAEU,IAAIH,EAAOC,GAAKX,QACvB,mCAAEF,EAAF,KAAQgB,EAAR,aAAkBhB,KAAUgB,GAAMhB,IAASgB,QAG/CX,IAAEY,SAGEC,EAAWb,IAAEc,KAAKd,IAAEe,QAAQhB,IAElC,OAAOC,IAAEgB,OACPH,EAAST,KAAI,SAACa,GAAD,MAAW,CACtBC,KAAM,CAAEC,GAAIF,EAAMG,MAAO7B,EAAYC,IAAIyB,GAAMzB,IAAI,kBAErDO,EAASK,KAAI,yCAAiB,CAAEc,KAAM,CAAEG,OAA3B,KAAyCC,OAAzC,Y,sCCtBFC,MAXf,WACE,IAEMC,EAFOC,KAEMD,QAAQpB,KAAI,SAACa,GAAD,OAAUA,EAAKE,QACxCO,EAHOD,KAIVC,QACAtB,KAAI,SAACuB,GAAD,MAAU,CAACA,EAAKN,SAASF,KAAMQ,EAAKL,SAASH,SAEpD,OAAOS,IAASC,MAAML,EAAOE,ICAhBI,EARE,SAAUC,GACpBA,GAILA,EAAU,aAAc,WAAYC,ICFtCC,IAAUC,IAAIX,GAWCY,MATf,SAA6B7C,GAM3B,OALW2C,IAAU,CACnBG,SAAU/C,EAAeC,GACzB+C,UAAU,IAGFD,WAAWb,a,8ICJvBU,IAAUC,IAAII,KAEd,IAAMC,EAAkB,CACtB,CACEC,SAAU,OACVC,MAAO,CACLC,MAAO,IACPC,OAAQ,GACRC,MAAO,YACPxB,MAAO,cACPyB,MAAO,QACP,cAAe,SACf,cAAe,SAEf,cACE,+HAGN,CACEL,SAAU,OACVC,MAAO,CACLC,MAAO,EACP,qBAAsB,WACtB,cAAe,UAiCNI,MA5Bf,YAAuC,IAAZxD,EAAW,EAAjByD,KACbC,EAAU3D,YAAeC,GAE/B,OACE,cAAC,IAAD,CACE2D,MAAM,EACNC,UAAW,MACXC,YAAa,IACbC,eAAe,EAJjB,SAME,cAAC,IAAD,CAAcF,UAAU,SAASG,WAAY,OAA7C,SACE,cAAC,IAAD,UACE,cAAC,IAAD,CACEjB,SAAUY,EACVM,OAAQ,CAAEC,KAAM,QAASC,6BAA6B,GACtDC,eAAe,EACfC,iBAAiB,EACjBC,QAAS,GACTC,QAAS,EACTnB,MAAO,CAAEC,MAAO,OAAQC,OAAQ,QAChCkB,WAAYtB,WCxDTO","file":"static/js/430.35611c2e.chunk.js","sourcesContent":["import _ from \"lodash\";\n\n//TODO: per-direction graphs\nfunction buildStopGraph(theRtif) {\n  const geographies = theRtif.get(\"geography\");\n  const revenueTrips = Array.from(theRtif.get(\"trip\").values()).filter(\n    (trip) => trip.get(\"tripType\") === 1\n  );\n\n  const allEdges = _.uniqWith(\n    revenueTrips.flatMap((trip) => {\n      const events = trip.get(\"event\");\n\n      const tripLocations = events.map((event) => event.get(\"location\"));\n\n      if (trip.get(\"direction\") !== \"S\") {\n        _.reverse(tripLocations);\n      }\n\n      const froms = tripLocations;\n      const tos = _.slice(tripLocations, 1);\n\n      return _.zip(froms, tos).filter(\n        ([from, to]) => !!from && !!to && from !== to\n      );\n    }),\n    _.isEqual\n  );\n\n  const allNodes = _.uniq(_.flatten(allEdges));\n\n  return _.concat(\n    allNodes.map((node) => ({\n      data: { id: node, label: geographies.get(node).get(\"shortName\") },\n    })),\n    allEdges.map(([from, to]) => ({ data: { source: from, target: to } }))\n  );\n}\n\nexport default buildStopGraph;\n","import toposort from \"toposort\";\n\nfunction topoSort() {\n  const eles = this;\n\n  const nodes = eles.nodes().map((node) => node.id());\n  const edges = eles\n    .edges()\n    .map((edge) => [edge.source().id(), edge.target().id()]);\n\n  return toposort.array(nodes, edges);\n}\n\nexport default topoSort;\n","import impl from \"./topoSort\";\n\nconst register = function (cytoscape) {\n  if (!cytoscape) {\n    return;\n  }\n\n  cytoscape(\"collection\", \"topoSort\", impl);\n};\n\nexport default register;\n","import Cytoscape from \"cytoscape\";\n\nimport topoSort from \"../topoSort\";\nimport buildStopGraph from \"./stopGraph\";\n\nCytoscape.use(topoSort);\n\nfunction buildSortedStopList(theRtif) {\n  const cy = Cytoscape({\n    elements: buildStopGraph(theRtif),\n    headless: true,\n  });\n\n  return cy.elements().topoSort();\n}\n\nexport default buildSortedStopList;\n","import React from \"react\";\n\nimport { EuiFlexGroup, EuiFlexItem, EuiPageTemplate } from \"@elastic/eui\";\nimport Cytoscape from \"cytoscape\";\nimport CytoscapeDagre from \"cytoscape-dagre\";\nimport CytoscapeComponent from \"react-cytoscapejs/src/component\";\n\nimport { buildStopGraph } from \"../../stopGraph\";\n\nCytoscape.use(CytoscapeDagre);\n\nconst cytoscapeStyles = [\n  {\n    selector: \"node\",\n    style: {\n      width: 100,\n      height: 35,\n      shape: \"rectangle\",\n      label: \"data(label)\",\n      color: \"black\",\n      \"text-valign\": \"center\",\n      \"text-halign\": \"center\",\n      //Note BlinkMacSystemFont excluded below due to https://crbug.com/1056386\n      \"font-family\":\n        '\"Inter\", -apple-system, \"Segoe UI\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"',\n    },\n  },\n  {\n    selector: \"edge\",\n    style: {\n      width: 3,\n      \"target-arrow-shape\": \"triangle\",\n      \"curve-style\": \"taxi\",\n    },\n  },\n];\n\nfunction StopGraph({ rtif: theRtif }) {\n  const cyInput = buildStopGraph(theRtif);\n\n  return (\n    <EuiPageTemplate\n      grow={true}\n      direction={\"row\"}\n      paddingSize={\"s\"}\n      restrictWidth={false}\n    >\n      <EuiFlexGroup direction=\"column\" gutterSize={\"none\"}>\n        <EuiFlexItem>\n          <CytoscapeComponent\n            elements={cyInput}\n            layout={{ name: \"dagre\", nodeDimensionsIncludeLabels: true }}\n            autoungrabify={true}\n            autounselectify={true}\n            minZoom={0.5}\n            maxZoom={2}\n            style={{ width: \"100%\", height: \"100%\" }}\n            stylesheet={cytoscapeStyles}\n          />\n        </EuiFlexItem>\n      </EuiFlexGroup>\n    </EuiPageTemplate>\n  );\n}\n\nexport default StopGraph;\n","import StopGraph from \"./StopGraph\";\nexport default StopGraph;\n"],"sourceRoot":""}